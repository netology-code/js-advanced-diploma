/*! For license information please see main.fae9c7b08ceff01f93ea.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkdiplom_ajs=self.webpackChunkdiplom_ajs||[]).push([[179],{903:()=>{function t(t,e){var r=e-t+1;return Math.floor(Math.random()*r)+t}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function r(t,r){for(var n=0;n<r.length;n++){var o=r[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,(void 0,i=function(t,r){if("object"!==e(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(o.key),"symbol"===e(i)?i:String(i)),o)}var i}var n=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generic";if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.level=e,this.attack=0,this.defence=0,this.health=50,this.type=r,this.attackRange=0,this.moveRange=0,"Character"===(this instanceof t?this.constructor:void 0).name)throw new Error('use "new Character()" denied')}var e,n;return e=t,(n=[{key:"isDead",value:function(){return this.health<=0}},{key:"levelUp",value:function(){this.level+=1,this.attack=Math.max(this.attack,Math.round(this.attack*((80+this.health)/100))),this.defence=Math.max(this.defence,Math.round(this.defence*((80+this.health)/100))),this.health=this.health>20?100:this.health+80}}])&&r(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}function a(t){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},a(t)}var c=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&i(t,e)}(s,t);var e,r,n,c=(r=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=a(r);if(n){var i=a(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(e=c.call(this,t,"bowman")).attack=25,e.defence=25,e.attackRange=2,e.moveRange=2,e}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(n);function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}var f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=u(r);if(n){var o=u(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===s(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t,"swordsman")).attack=40,e.defence=10,e.attackRange=1,e.moveRange=4,e}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(n);function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function y(t,e){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},y(t,e)}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},p(t)}var d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&y(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=p(r);if(n){var o=p(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===h(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t,"magician")).attack=10,e.defence=40,e.attackRange=4,e.moveRange=1,e}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(n);function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function m(t,e){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},m(t,e)}function b(t){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},b(t)}var g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&m(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=b(r);if(n){var o=b(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===v(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t,"vampire")).attack=25,e.defence=25,e.attackRange=2,e.moveRange=2,e}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(n);function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function S(t,e){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},S(t,e)}function P(t){return P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},P(t)}var C=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&S(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=P(r);if(n){var o=P(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===w(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t,"undead")).attack=40,e.defence=10,e.attackRange=1,e.moveRange=4,e}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(n);function k(t){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k(t)}function O(t,e){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},O(t,e)}function E(t){return E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},E(t)}var L=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&O(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=E(r);if(n){var o=E(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===k(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t,"daemon")).attack=10,e.defence=10,e.attackRange=4,e.moveRange=1,e}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(n);function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}function T(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=x(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function x(t,e){if(t){if("string"==typeof t)return _(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_(t,e):void 0}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function I(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==j(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==j(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===j(o)?o:String(o)),n)}var o}var R=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.boardSize=8,this.initialNumberOfChars=2,this.userPlayerTypes=[c,f,d],this.compPlayerTypes=[g,C,L],this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]}var e,r,n;return e=t,r=[{key:"bindToDOM",value:function(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}},{key:"drawUi",value:function(t){var e,r,n=this;this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n        <div class="score">\n          <span>Hit points</span>\n          <span class="score__value">0000</span>\n        </div>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.scoreEl=this.container.querySelector(".score__value"),this.newGameEl.addEventListener("click",(function(t){return n.onNewGameClick(t)})),this.saveGameEl.addEventListener("click",(function(t){return n.onSaveGameClick(t)})),this.loadGameEl.addEventListener("click",(function(t){return n.onLoadGameClick(t)})),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(var o=0;o<Math.pow(this.boardSize,2);o+=1){var i=document.createElement("div");i.classList.add("cell","map-tile","map-tile-".concat((e=o,r=this.boardSize,e?e===r-1?"top-right":Math.floor(e/(r-1))?e===r*r-r?"bottom-left":e===r*r-1?"bottom-right":e%r?(e+1)%r?Math.floor(e/(r*r-r))?"bottom":"center":"right":"left":"top":"top-left"))),i.addEventListener("mouseenter",(function(t){return n.onCellEnter(t)})),i.addEventListener("mouseleave",(function(t){return n.onCellLeave(t)})),i.addEventListener("click",(function(t){return n.onCellClick(t)})),this.boardEl.appendChild(i)}this.cells=Array.from(this.boardEl.children)}},{key:"renderScore",value:function(t){if(t<0)throw new Error("Score must be greater than 0");var e="".concat("0".repeat(4-t.toString().length)).concat(t);this.scoreEl.textContent=e}},{key:"redrawPositions",value:function(t){var e,r=T(this.cells);try{for(r.s();!(e=r.n()).done;)e.value.innerHTML=""}catch(t){r.e(t)}finally{r.f()}var n,o,i=T(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,c=this.boardEl.children[a.position],s=document.createElement("div");s.classList.add("character",a.character.type);var l=document.createElement("div");l.classList.add("health-level");var u=document.createElement("div");u.classList.add("health-level-indicator","health-level-indicator-".concat((o=a.character.health)<15?"critical":o<50?"normal":"high")),u.style.width="".concat(a.character.health,"%"),l.appendChild(u),s.appendChild(l),c.appendChild(s)}}catch(t){i.e(t)}finally{i.f()}}},{key:"addCellEnterListener",value:function(t){this.cellEnterListeners.push(t)}},{key:"addCellLeaveListener",value:function(t){this.cellLeaveListeners.push(t)}},{key:"addCellClickListener",value:function(t){this.cellClickListeners.push(t)}},{key:"addNewGameListener",value:function(t){this.newGameListeners.push(t)}},{key:"addSaveGameListener",value:function(t){this.saveGameListeners.push(t)}},{key:"addLoadGameListener",value:function(t){this.loadGameListeners.push(t)}},{key:"onCellEnter",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellLeave",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellClick",value:function(t){var e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onNewGameClick",value:function(t){t.preventDefault(),this.newGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onSaveGameClick",value:function(t){t.preventDefault(),this.saveGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onLoadGameClick",value:function(t){t.preventDefault(),this.loadGameListeners.forEach((function(t){return t.call(null)}))}},{key:"selectCell",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(t),this.cells[t].classList.add("selected","selected-".concat(e))}},{key:"deselectCell",value:function(t){var e,r,n=this.cells[t];(e=n.classList).remove.apply(e,function(t){if(Array.isArray(t))return _(t)}(r=Array.from(n.classList).filter((function(t){return t.startsWith("selected")})))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||x(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}},{key:"showCellTooltip",value:function(t,e){this.cells[e].title=t}},{key:"hideCellTooltip",value:function(t){this.cells[t].title=""}},{key:"showDamage",value:function(t,e){var r=this;return new Promise((function(n){var o=r.cells[t],i=document.createElement("span");i.textContent=e,i.classList.add("damage"),o.appendChild(i),i.addEventListener("animationend",(function(){o.removeChild(i),n()}))}))}},{key:"setCursor",value:function(t){this.boardEl.style.cursor=t}},{key:"checkBinding",value:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}],n=[{key:"showError",value:function(t){alert(t)}},{key:"showMessage",value:function(t){alert(t)}}],r&&I(e.prototype,r),n&&I(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}function G(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==B(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===B(o)?o:String(o)),n)}var o}function A(t,e,r){return e&&G(t.prototype,e),r&&G(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var M=A((function t(e,r){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!(e instanceof n))throw new Error("character must be instance of Character or its children");if("number"!=typeof r)throw new Error("position must be a number");this.character=e,this.position=r}));function N(t){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N(t)}function F(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==N(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==N(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===N(o)?o:String(o)),n)}var o}var D=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.currentLevel=1,this.positionedCharacters=[],this.selected=null,this.score=0}var e,r,n;return e=t,n=[{key:"from",value:function(t){var e={};for(var r in t)Object.hasOwn(t,r)&&(e[r]=t[r]);return e}},{key:"createCharacterFromObject",value:function(t){var e=new([c,f,d,g,C,L].find((function(e){return e.name.toLowerCase()===t.type})));for(var r in t)Object.hasOwn(t,r)&&(e[r]=t[r]);return e}}],(r=[{key:"setState",value:function(e){var r=this;this.currentLevel=e.currentLevel,this.score=e.score,this.positionedCharacters=[],e.positionedCharacters.forEach((function(e){var n=t.createCharacterFromObject(e.character);r.positionedCharacters.push(new M(n,e.position))}))}}])&&F(e.prototype,r),n&&F(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function U(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Y(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Y(o)?o:String(o)),n)}var o}var V=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.storage=e}var e,r;return e=t,(r=[{key:"save",value:function(t){this.storage.setItem("state",JSON.stringify(t))}},{key:"load",value:function(){try{return JSON.parse(this.storage.getItem("state"))}catch(t){throw new Error("Invalid state")}}},{key:"saveHiScore",value:function(t){this.storage.setItem("hiscore",t.toString())}},{key:"loadHiScore",value:function(){try{return+this.storage.getItem("hiscore")}catch(t){throw new Error("Invalid hiscore")}}}])&&U(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function X(t){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X(t)}function H(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==X(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==X(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===X(o)?o:String(o)),n)}var o}var z=function(){function t(e,r){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.allowedTypes=e,this.generatorFunc=r,this.characters=o.filter((function(t){return n.allowedTypes.find((function(e){return e.name.toLowerCase()===t.type}))}))}var e,r;return e=t,r=[{key:"count",get:function(){return this.characters.length}},{key:"addRandomChar",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=this.generatorFunc(this.allowedTypes,t),n=0;n<e;n++)this.characters.push(r.next().value)}},{key:"remove",value:function(t){var e=this.characters.indexOf(t);return-1===e?null:this.characters.splice(e,1)}},{key:"clear",value:function(){this.characters=[]}},{key:"isOwnCharacter",value:function(t){return this.characters.includes(t)}},{key:"isEmpty",value:function(){return!this.characters.length}}],r&&H(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function q(t){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},q(t)}function J(){J=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof h?e:h,a=Object.create(i.prototype),c=new O(o||[]);return n(a,"_invoke",{value:S(t,r,c)}),a}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function h(){}function y(){}function p(){}var d={};s(d,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(E([])));m&&m!==e&&r.call(m,i)&&(d=m);var b=p.prototype=h.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var s=u(t[n],t,i);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==q(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(s.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function S(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=P(a,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=u(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}function P(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,P(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=u(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function E(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:L}}function L(){return{value:void 0,done:!0}}return y.prototype=p,n(b,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:y,configurable:!0}),y.displayName=s(p,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(w.prototype),s(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),s(b,c,"Generator"),s(b,i,(function(){return this})),s(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=E,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),s=r.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:E(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}var $,W,K,Q=J().mark(Z);function Z(e,r){var n,o;return J().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n=t(1,r),o=t(0,e.length-1),i.next=5,new e[o](n);case 5:i.next=0;break;case 7:case"end":return i.stop()}}),Q)}function tt(t){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tt(t)}function et(){et=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof h?e:h,a=Object.create(i.prototype),c=new O(o||[]);return n(a,"_invoke",{value:S(t,r,c)}),a}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function h(){}function y(){}function p(){}var d={};s(d,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(E([])));m&&m!==e&&r.call(m,i)&&(d=m);var b=p.prototype=h.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var s=u(t[n],t,i);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==tt(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(s.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function S(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=P(a,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=u(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}function P(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,P(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=u(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function E(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:L}}function L(){return{value:void 0,done:!0}}return y.prototype=p,n(b,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:y,configurable:!0}),y.displayName=s(p,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(w.prototype),s(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),s(b,c,"Generator"),s(b,i,(function(){return this})),s(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=E,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),s=r.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:E(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}const rt=($={prairie:"prairie",desert:"desert",arctic:"arctic",mountain:"mountain"},W=Symbol.iterator,K=et().mark((function t(){var e,r,n;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=0,r=Object.values(this);case 1:if(!(e<r.length)){t.next=8;break}return n=r[e],t.next=5,n;case 5:e++,t.next=1;break;case 8:case"end":return t.stop()}}),t,this)})),(W=function(t){var e=function(t,e){if("object"!==tt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==tt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===tt(e)?e:String(e)}(W))in $?Object.defineProperty($,W,{value:K,enumerable:!0,configurable:!0,writable:!0}):$[W]=K,$),nt="auto",ot="pointer",it="crosshair",at="not-allowed";function ct(t){return ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ct(t)}function st(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=ft(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function lt(t){return function(t){if(Array.isArray(t))return ht(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||ft(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ut(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],s=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);s=!0);}catch(t){l=!0,o=t}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||ft(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ft(t,e){if(t){if("string"==typeof t)return ht(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ht(t,e):void 0}}function ht(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function yt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,pt(n.key),n)}}function pt(t){var e=function(t,e){if("object"!==ct(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ct(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===ct(e)?e:String(e)}var dt=function(){function e(t,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.gamePlay=t,this.stateService=r,this.userPlayerTypes=[c,f,d],this.compPlayerTypes=[g,C,L],this.gameStateService=new V(localStorage),this.registerEventListeners()}var r,n;return r=e,(n=[{key:"registerEventListeners",value:function(){this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addNewGameListener(this.onNewGame.bind(this)),this.gamePlay.addLoadGameListener(this.onLoadGame.bind(this)),this.gamePlay.addSaveGameListener(this.onSaveGame.bind(this))}},{key:"init",value:function(){this.isEventsBlocked=!0,this.isMoveValid=!1,this.isAttackValid=!1,this.gameState=new D,this.gamePlay.drawUi(Array.from(rt)[0]),this.userPlayerTeam=new z(this.userPlayerTypes,Z),this.userPlayerTeam.addRandomChar(1,this.gamePlay.initialNumberOfChars),this.compPlayerTeam=new z(this.compPlayerTypes,Z),this.compPlayerTeam.addRandomChar(1,this.gamePlay.initialNumberOfChars),this.placeUserTeamOnBoard(),this.placeCompTeamOnBoard(),this.gamePlay.redrawPositions(this.gameState.positionedCharacters),this.isEventsBlocked=!1}},{key:"placeUserTeamOnBoard",value:function(){var t=this,e=this.getInitialPositions("user",this.userPlayerTeam.count);this.userPlayerTeam.characters.forEach((function(r,n){t.gameState.positionedCharacters.push(new M(r,e[n]))}))}},{key:"placeCompTeamOnBoard",value:function(){var t=this,e=this.getInitialPositions("comp",this.compPlayerTeam.count);this.compPlayerTeam.characters.forEach((function(r,n){t.gameState.positionedCharacters.push(new M(r,e[n]))}))}},{key:"getInitialPositions",value:function(t,e){for(var r=[],n=0;n<e;){var o="user"===t?this.getRandomUserCharPosition():this.getRandomCompCharPosition();r.includes(o)||(r.push(o),n+=1)}return r}},{key:"getRandomUserCharPosition",value:function(){return this.getRandomCellInTwoColumns(0)}},{key:"getRandomCompCharPosition",value:function(){return this.getRandomCellInTwoColumns(this.gamePlay.boardSize-2)}},{key:"getRandomCellInTwoColumns",value:function(e){var r=this.gamePlay.boardSize,n=t(0,2*r-1);return n<r?n*r+e:(n-r)*r+1+e}},{key:"onNewGame",value:function(){confirm("Вы уверены что хотите начать новую игру?")&&this.init()}},{key:"onLoadGame",value:function(){var t=this.gameStateService.load();this.gameState.setState(t),this.userPlayerTeam=new z(this.userPlayerTypes,Z,this.getCharactersFromPositionedCaracters()),this.compPlayerTeam=new z(this.compPlayerTypes,Z,this.getCharactersFromPositionedCaracters()),this.gamePlay.drawUi(Array.from(rt)[this.gameState.currentLevel-1]),this.gamePlay.redrawPositions(this.gameState.positionedCharacters),this.gamePlay.renderScore(this.gameState.score),this.isEventsBlocked=!1}},{key:"onSaveGame",value:function(){this.isEventsBlocked||this.gameStateService.save(D.from(this.gameState))}},{key:"onCellClick",value:function(t){var e=this;if(!this.isEventsBlocked){var r=this.getCharInPositionByIndex(t);if(!this.gameState.selected&&r)return this.userPlayerTeam.isOwnCharacter(r)?(this.gameState.selected=r,void this.gamePlay.selectCell(t)):void R.showError("Это не ваш персонаж!");if(this.gameState.selected&&this.userPlayerTeam.isOwnCharacter(r)){var n=this.getIndexByChar(this.gameState.selected);return this.gamePlay.deselectCell(n),this.gameState.selected=r,void this.gamePlay.selectCell(t)}if(this.isAttackValid||this.isMoveValid)return this.isMoveValid?(this.isEventsBlocked=!0,this.gamePlay.setCursor(at),this.deselectCharCells(t),this.moveCharacterToIndex(this.gameState.selected,t),this.gameState.selected=null,this.enemyTurn(),void(this.isEventsBlocked=!1)):void(this.isAttackValid&&(this.isEventsBlocked=!0,this.gamePlay.setCursor(at),this.deselectCharCells(t),this.attackHandler(this.gameState.selected,this.getCharInPositionByIndex(t)).then((function(t){e.gameState.selected=null,t?e.toNextLevel():(e.enemyTurn(),e.isEventsBlocked=!1)}))));R.showError("Не допустимое действие!")}}},{key:"onCellEnter",value:function(t){if(!this.isEventsBlocked){var e=this.getCharInPositionByIndex(t);e&&this.setTooltipOnCharacter(t),this.userPlayerTeam.isOwnCharacter(e)?this.gamePlay.setCursor(ot):this.compPlayerTeam.isOwnCharacter(e)&&this.gameState.selected?this.isValidAttackArea(t)?(this.gamePlay.setCursor(it),this.gamePlay.selectCell(t,"red"),this.isAttackValid=!0):this.gamePlay.setCursor(at):e||!this.gameState.selected?this.gamePlay.setCursor(at):this.isValidMoveArea(t)?(this.gamePlay.setCursor(ot),this.gamePlay.selectCell(t,"green"),this.isMoveValid=!0):this.gamePlay.setCursor(at)}}},{key:"onCellLeave",value:function(t){if(!this.isEventsBlocked){var e=this.getCharInPositionByIndex(t);this.hideTooltipOnCharacter(t),this.gamePlay.setCursor(nt),this.isAttackValid=!1,this.isMoveValid=!1,this.userPlayerTeam.isOwnCharacter(e)||this.gamePlay.deselectCell(t)}}},{key:"getCharInPositionByIndex",value:function(t){var e=this.gameState.positionedCharacters.find((function(e){return e.position===t}));return void 0===e?null:e.character}},{key:"getPositionedCharByChar",value:function(t){return this.gameState.positionedCharacters.find((function(e){return e.character===t}))}},{key:"getIndexByChar",value:function(t){return this.getPositionedCharByChar(t).position}},{key:"getCharactersFromPositionedCaracters",value:function(){return this.gameState.positionedCharacters.map((function(t){return t.character}))}},{key:"setTooltipOnCharacter",value:function(t){var e=this.getCharInPositionByIndex(t),r=e.level,n=e.attack,o=e.defence,i=e.health,a="🎖".concat(r," ⚔").concat(n," 🛡").concat(o," ❤").concat(i);this.gamePlay.showCellTooltip(a,t)}},{key:"hideTooltipOnCharacter",value:function(t){this.gamePlay.hideCellTooltip(t)}},{key:"isValidAttackArea",value:function(t){var e=this.gameState.selected.attackRange,r=this.getIndexByChar(this.gameState.selected),n=ut(this.getXYbyIndex(t),2),o=n[0],i=n[1],a=ut(this.getXYbyIndex(r),2),c=a[0],s=a[1];return o>=c-e&&o<=c+e&&i>=s-e&&i<=s+e}},{key:"isValidMoveArea",value:function(t){for(var e=this.gameState.selected.moveRange,r=this.getIndexByChar(this.gameState.selected),n=ut(this.getXYbyIndex(t),2),o=n[0],i=n[1],a=ut(this.getXYbyIndex(r),2),c=a[0],s=a[1],l=c-e,u=s-e,f=s+e;l<=c+e;l++,u++,f--)if(o===l&&i===u||o===l&&i===f)return!0;return i===s&&o>=c-e&&o<=c+e||o===c&&i>=s-e&&i<=s+e}},{key:"getXYbyIndex",value:function(t){var e=this.gamePlay.boardSize;return[t%e,Math.floor(t/e)]}},{key:"getIndexByXY",value:function(t,e){return 8*e+t}},{key:"moveCharacterToIndex",value:function(t,e){this.getPositionedCharByChar(t).position=e,this.gamePlay.redrawPositions(this.gameState.positionedCharacters)}},{key:"attackHandler",value:function(t,e){var r=this;return new Promise((function(n){var o=Math.round(Math.max(t.attack-e.defence,.1*t.attack)),i=r.getIndexByChar(e);e.health=e.health-o<0?0:e.health-o,r.userPlayerTeam.isOwnCharacter(t)&&(r.gameState.score+=o,r.gamePlay.renderScore(r.gameState.score)),r.gamePlay.showDamage(i,o.toFixed()).then((function(){e.isDead()&&r.removeCharFromTeam(e);var t=r.compPlayerTeam.isEmpty()||r.userPlayerTeam.isEmpty();r.gamePlay.redrawPositions(r.gameState.positionedCharacters),n(t)}))}))}},{key:"removeCharFromTeam",value:function(t){var e=this.gameState.positionedCharacters.findIndex((function(e){return e.character===t}));this.gameState.positionedCharacters.splice(e,1),this.compPlayerTeam.remove(t),this.userPlayerTeam.remove(t)}},{key:"deselectCharCells",value:function(t){var e=this.getIndexByChar(this.gameState.selected);this.gamePlay.deselectCell(e),this.gamePlay.deselectCell(t)}},{key:"enemyTurn",value:function(){var t=this;return new Promise((function(e){t.doTurn(),t.isEventsBlocked=!1,e()}))}},{key:"doTurn",value:function(){var t=this,e=this.getCloseInFightOpponents()||this.getDistanceFightOpponent();if(e){var r=e.char,n=e.target;this.attackHandler(r,n).then((function(e){e&&t.toNextLevel()}))}else this.compCharMove()}},{key:"getCloseInFightOpponents",value:function(){var t,e=st(this.sortCharsBy(lt(this.compPlayerTeam.characters),"attack"));try{for(e.s();!(t=e.n()).done;){var r=t.value,n=this.getAllTargetsInArea(r,1);if(n.length){var o=this.sortCharsBy(n,"defence");return{char:r,target:o[o.length-1]}}}}catch(t){e.e(t)}finally{e.f()}return null}},{key:"getDistanceFightOpponent",value:function(){var t,e=st(this.sortCharsBy(lt(this.compPlayerTeam.characters),"attackRange"));try{for(e.s();!(t=e.n()).done;){var r=t.value,n=r.attackRange,o=this.getAllTargetsInArea(r,n);if(o.length){var i=this.sortCharsBy(o,"defence");return{char:r,target:i[i.length-1]}}}}catch(t){e.e(t)}finally{e.f()}return null}},{key:"compCharMove",value:function(){var t,e,r=this.sortCharsBy(lt(this.compPlayerTeam.characters),"moveRange")[0],n=this.getClosestTargetsInArea(r),o=this.sortCharsBy(n,"moveRange")[0],i=this.gamePlay.boardSize,a=r.moveRange,c=ut(this.getXYbyIndex(this.getIndexByChar(r)),2),s=c[0],l=c[1],u=ut(this.getXYbyIndex(this.getIndexByChar(o)),2),f=u[0],h=u[1],y=Math.atan2(f-s,h-l),p=Math.round(y/(Math.PI/4))*(Math.PI/4);do{t=Math.round(Math.sin(p)*a),e=Math.round(Math.cos(p)*a),a-=1}while(s+t<0||l+e<0||s+t>=i||l+e>=i||this.getCharInPositionByIndex(this.getIndexByXY(s+t,l+e)));var d=this.getIndexByXY(s+t,l+e);this.moveCharacterToIndex(r,d)}},{key:"sortCharsBy",value:function(t,e){return t.sort((function(t,r){return r[e]-t[e]})),t}},{key:"getAllTargetsInArea",value:function(t,e){for(var r=this.gamePlay.boardSize,n=ut(this.getXYbyIndex(this.getIndexByChar(t)),2),o=n[0],i=n[1],a=[],c=o-e;c<=o+e;c++)for(var s=i-e;s<=i+e;s++)if(!(c>=r||s>=r||c<0||s<0||c===o&&s===i)){var l=this.getIndexByXY(c,s),u=this.getCharInPositionByIndex(l);u&&this.userPlayerTeam.isOwnCharacter(u)&&a.push(u)}return a}},{key:"getClosestTargetsInArea",value:function(t){for(var e=this.gamePlay.boardSize,r=ut(this.getXYbyIndex(this.getIndexByChar(t)),2),n=r[0],o=r[1],i=Math.max(n,o,e-n-1,e-o-1),a=2;a<=i;a++){var c=this.getAllTargetsInArea(t,a);if(c.length)return c}return null}},{key:"toNextLevel",value:function(){if(this.isEventsBlocked=!0,4!=this.gameState.currentLevel++){var t,e=st(this.userPlayerTeam.characters);try{for(e.s();!(t=e.n()).done;)t.value.levelUp()}catch(t){e.e(t)}finally{e.f()}var r,n=st(this.compPlayerTeam.characters);try{for(n.s();!(r=n.n()).done;)r.value.levelUp()}catch(t){n.e(t)}finally{n.f()}this.gameState.positionedCharacters=[],this.gamePlay.drawUi(Array.from(rt)[this.gameState.currentLevel-1]),this.addNewCharsToTeam(this.gameState.currentLevel-1),this.placeUserTeamOnBoard(),this.placeCompTeamOnBoard(),this.gamePlay.renderScore(this.gameState.score),this.gamePlay.redrawPositions(this.gameState.positionedCharacters),this.isEventsBlocked=!1}else this.gameOver()}},{key:"addNewCharsToTeam",value:function(t){var e=this.gamePlay.initialNumberOfChars+t-this.userPlayerTeam.count,r=this.gamePlay.initialNumberOfChars+t-this.compPlayerTeam.count;this.userPlayerTeam.addRandomChar(1,e),this.compPlayerTeam.addRandomChar(1,r)}},{key:"gameOver",value:function(){var t=this.gameStateService.loadHiScore();alert("Игра окончена. Вы набрали ".concat(this.gameState.score," очков.\n Рекорд ").concat(t," очков")),this.gameState.score>t&&this.gameStateService.saveHiScore(this.gameState.score)}}])&&yt(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),e}(),vt=new R;vt.bindToDOM(document.querySelector("#game-container")),new dt(vt,new V(localStorage)).init()}},t=>{t(t.s=903)}]);